# Build v Buy for Fine-Grained RBAC

## Buy Options

* WorkOS
* Okta

| **Features**                                   | **Workos**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | **Okta**                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ---------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Unique Benefits                                | WorkOS is a set of building blocks for quickly adding enterprise features to your app. You’ll be shipping quickly with a market-proven solution for your customers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Simplified SSO solution unifying Azure/AWS and multiple third party vendors                                                                                                                                                                                                                                                                                                                                                          |
| User Experience                                | [https://workos.com/docs/user-management/authkit](https://workos.com/docs/user-management/authkit) AuthKit a very clean package for building auth                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Brandable, simple self-service, reviews note Okta’s ease-of-use overall.                                                                                                                                                                                                                                                                                                                                                             |
| IdP Support                                    | SAML, OIDC, SCIM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Social login, SAML 2.0, Smart Card (not useful for our purposes but interesting), generic OIDC.                                                                                                                                                                                                                                                                                                                                      |
| MFA                                            | topt and sms                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | “You can require authenticators for apps or groups of users and specify which ones can be used for account recovery.”<br>Okta supports:<br>Email, Phone, Custom OTP, Custom Authenticator, Duo Security, Google Authenticator, Symantec VIP, YubiKey OTP, Smart Card,<br>[Okta Verify](https://help.okta.com/oie/en-us/content/topics/identity-engine/authenticators/configure-okta-verify.htm), FIDO2, Security Questions, Password |
| User Lifecycle Management                      | Users can be managed from a provided OS, and Automatic User Provisioning can be done via JIT provisioning [https://workos.com/user-management](https://workos.com/user-management)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Automations around joiners/leavers/movers, a portal for provisioning/deprovisioning. Can organize identities across multiple sources (HR resource management software, Active Directory, AWS, etc). This means an identity could be updated in HR software [retirement date/department move/etc], and Okta will automatically sync that information to update user permissions/software license provision for the employee.          |
| API-Driven                                     | Extremely.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | REST API, docs: [https://developer.okta.com/docs/reference/core-okta-api/](https://developer.okta.com/docs/reference/core-okta-api/)                                                                                                                                                                                                                                                                                                 |
| Group Management                               | Users sit within Organisations. The Organisations model is flexible, and users can be in many organisations or just the one.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Okta performs lifecycle management based on groups - groups can sync to match departments and domain functions.                                                                                                                                                                                                                                                                                                                      |
| Customer Identity and Access Management (CIAM) | JIT provisioning, directory sync [https://workos.com/directory-sync](https://workos.com/directory-sync)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Furthermore, “routing rules [can be set up] to direct users to an IdP based on context, such as the user's location, device, or email domain.” - allowing us to control access for customers based on context.                                                                                                                                                                                                                       |
| B2B Collaborator Support                       | Directory sync                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Centralized user management and provisioning for third parties and partners.                                                                                                                                                                                                                                                                                                                                                         |
| Privileged Access Management (PAM) tools       | I’m not seeing any built in PAM tools                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Privileged access governance including business controls (multi-step approval and time-bound approvals) and integration with Okta System Log to view all actions.                                                                                                                                                                                                                                                                    |
| Fine-Grained RBAC Policies                     | [https://workos.com/docs/directory-sync/identity-provider-role-assignment](https://workos.com/docs/directory-sync/identity-provider-role-assignment) group-based role assignment.<br>“Having a user who belongs to multiple groups is a common scenario. For example, there might be a case where an employee<br>_Jane_ is an _Engineering Manager_ and belongs to an “Engineering”, “Manager”, and “Admin” group. With group-based role assignment, the user will be assigned the role that has the [highest priority defined](https://workos.com/docs/(/roles/roles))”<br><br>This may result in us having to build out very specific roles. However, WorkOS has recently acquired Warrant (a FGA tool for devs). | Okta has FGA that follows the language in Google’s Zanzibar RBAC paper. [https://docs.fga.dev/modeling/configuration-language](https://docs.fga.dev/modeling/configuration-language)                                                                                                                                                                                                                                                 |
| Conditional Access                             | I haven’t found an example of this                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Possible to set up a a conditional access policy: [https://www.okta.com/uk/blog/2022/05/how-do-conditional-access-systems-work/](https://www.okta.com/uk/blog/2022/05/how-do-conditional-access-systems-work/)                                                                                                                                                                                                                       |
| Reporting Capabilities                         | Done via audit logs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Realtime log, pre-built reports, exportable full system log, API queryable full system log, can integrate with Splunk, can download CSVs of events.                                                                                                                                                                                                                                                                                  |
| Auditing Capabilities                          | [https://workos.com/audit-logs](https://workos.com/audit-logs) Audit logs available and exportable. Can audit based on events.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Early Access - can use Systems Log to audit events: [https://help.okta.com/asa/en-us/content/topics/adv_server_access/docs/audit-events-with-okta-syslog.htm](https://help.okta.com/asa/en-us/content/topics/adv_server_access/docs/audit-events-with-okta-syslog.htm)                                                                                                                                                               |
| Integration                                    | Integrates with Cognito, EntraID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Integrates with **AWS IAM, Cognito, Azure**                                                                                                                                                                                                                                                                                                                                                                                          |
| Support                                        | All customers have access to [documentation](https://workos.com/docs), email support, and in-product web support. Premium support options include expert guided integration and response time SLAs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Help Center, Ask the Community, email, phone.<br>SLA:<br><br>                                                                                                                                                                                                                                                                                                                                                                        |
| Availability                                   | 99.99% [https://workos.com/changelog/99-99-availability-for-sso-directory-sync-and-audit-logs](https://workos.com/changelog/99-99-availability-for-sso-directory-sync-and-audit-logs)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 99.99% in 2022                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Architecture                                   | Uncertain, but Ruby on Rails and Java are two languages a lot of their senior devs have on their LinkedIn.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Multitenant, cell-based with sub-processor failover.                                                                                                                                                                                                                                                                                                                                                                                 |
| Adverse News                                   | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Okta breach: [https://sec.okta.com/harfiles](https://sec.okta.com/harfiles) / [https://www.wired.com/story/okta-breach-disclosure-all-customer-support-users/](https://www.wired.com/story/okta-breach-disclosure-all-customer-support-users/)                                                                                                                                                                                       |
| Pricing Model                                  | $125/connection/month for SSO, $125/connection/month for Directory Sync, $5/org/month for Audit logs…….or $125/org/month if we want those logs outside of .csv                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | $1,500 annual contract minimum.<br><br>_Privileged Access pricing: $14/unit per month._<br>Adaptive SSO: $5/user/month<br>Adaptive MFA: $6/user/month<br>Universal Directory:<br>$2/user/month<br>Identity Governance:<br>$9/user/month<br>Lifecycle Management: $4/user/month<br>API Access Management: $2<br>Device Access: $4/user/month                                                                                          |
| Overall Cost                                   | Assuming 5 external orgs with directory sync, audit logs, and a custom domain, I got an estimated monthly bill of $1349                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | For each employee: $30/user/month<br>For each external user: $11/user/month<br><br>**ESTIMATED: I don’t have data yet as to if some of these costs can be folded into each other. I believe we may need a quote from their sales team for that.**                                                                                                                                                                                    |
## Buy Recommendation 

* Due to the cost associated with Okta, I'd recommend we lean towards WorkOS for build efficiency and cost-effectiveness. 


## Build Option

We can also use EntraID and Azure to set up our user permissions.

Using Azure, users can be controlled programmatically using Terraform, which would offer us IaC control (Please see [/solutionsBuildingBlocks\proofOfConcepts\userControlAzure](here) for a quick PoC).

In order to ensure synchronicity in a cross-cloud environment we can use the Federated Identity Pattern [/referenceLibrary/patternLibrary/federatedIdentity.md](here) to delegate authorisation to consolidate cross-cloud user management. In the case of this build option, the idea is to utilise **Azure,** specifically **EntraID** as the user manager.

This would allow us to grant access to the data required by a user's identity while providing a cohesive experience.

### Provisioning Users

### Setting up SSO

**Steps:**
1. Within Azure Portal, create a new Enterprise Application
2. From Enterprise Application Gallery, select AWS IAM Identity Centre
3. On the Single Sign-On page, select SAML
4. 

**Notes**
If ABAC is enabled in AWS IAM Identity Center, the additional attributes may be passed as session tags directly into AWS accounts.


# Recommendation

At this point, comparing WorkOS and building via Azure, I would recommend Azure. Using AzureAD would give us a one-stop shop and minimise our attack surfaces (see Secure by Design principles).